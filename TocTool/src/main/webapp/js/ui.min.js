var DATE_FORMAT="yyyy-mm-dd";var numberbox=(function($){function onBeforeChange(oNumberInput,changeQty,isInputHasChange){var $numberInput=$(oNumberInput);var onbeforechange=$numberInput.attr("onbeforechange");if(onbeforechange){var onbeforechangeFunc=eval(onbeforechange);if(onbeforechangeFunc){return onbeforechangeFunc(oNumberInput,changeQty,isInputHasChange)}}else{return true}}return{plusNumber:function(oBtnPlus){var $numberInput=$(oBtnPlus).parent().find("input");var $numberPad=$(oBtnPlus).parent();var steplength=$numberPad.attr("data-steplength")*1;var maxvalue=($numberPad.attr("maxvalue"))*1;var srcValue=($numberInput.val())*1;var remaind=srcValue%steplength;var newValue=srcValue-remaind+steplength;var msg=$numberPad.attr("data-maxInfo");if(newValue>maxvalue){showTips(msg,oBtnPlus);return false}var isContinue=onBeforeChange($numberInput[0],(newValue-srcValue),false);if(!isContinue){return false}$numberInput.val(newValue)},reduceNumber:function(oBtnReduce){var $numberInput=$(oBtnReduce).parent().find("input");var $numberPad=$(oBtnReduce).parent();var steplength=$numberPad.attr("data-steplength")*1;var minValue=($numberPad.attr("minvalue"))*1;var srcValue=($numberInput.val())*1;var remaind=srcValue%steplength;var newValue=srcValue-((remaind>0)?(remaind-steplength):0)-steplength;var msg=$numberPad.attr("data-minInfo");if(newValue<minValue){showTips(msg,oBtnReduce);return false}var isContinue=onBeforeChange($numberInput[0],(newValue-srcValue),false);if(!isContinue){return false}$numberInput.val(newValue)},doFocus:function(oNumberInput){$(oNumberInput).attr("data-oldvalue",oNumberInput.value)},doOnEnter:function(oNumberInput,btnSureId,evt){if(evt.which==13){if(btnSureId){$("#"+btnSureId).click()}}},doNumberChange:function(oNumberInput,e){var $numberboxPad=$(oNumberInput).parent();var maxvalue=$numberboxPad.attr("maxvalue")*1;var minvalue=$numberboxPad.attr("minvalue")*1;var currValue=$(oNumberInput).val()*1;var minInfo=$numberboxPad.attr("data-minInfo");var maxInfo=$numberboxPad.attr("data-maxInfo");var stepLength=$numberboxPad.attr("data-steplength");if(!stepLength){stepLength=1}var msg=null;if(isNaN(currValue)){msg="请输入数字"}else{if(currValue<minvalue){msg=minInfo}else{if(currValue>maxvalue){msg=maxInfo}}}if(!msg&&currValue%stepLength!==0){msg="输入的数字应当是"+stepLength+"的整数倍。"}if(msg){var oldvalue=$(oNumberInput).attr("data-oldvalue");if(oldvalue==""){$(oNumberInput).val($(oNumberInput).attr("data-init"))}else{$(oNumberInput).val(oldvalue)}showTips(msg,oNumberInput)}else{var isContinue=onBeforeChange(oNumberInput,0,true);if(isContinue){if(currValue<minvalue){msg=minInfo}else{if(currValue>maxvalue){msg=maxInfo}}if(msg){$(oNumberInput).val($(oNumberInput).attr("data-init"));showTips(msg,oNumberInput)}else{$(oNumberInput).attr("data-init",currValue)}}else{$(oNumberInput).val($(oNumberInput).attr("data-oldvalue"));return}}}}}(jQuery));var selectbox=(function(a){return{init:function(){var c=a(".selectbox"),b=a(".selectbox_trigger",c),d=a("div.selectbox_drop",c);b.on("click",function(e){if(a(this).data("active")!=="on"){a(this).parent().next().show();a(this).data("active","on")}else{a(this).parent().next().hide();a(this).data("active","off")}});c.on("keyup","#selectbox_drop_search",function(){var e=new RegExp(a(this).val());d.find("li").each(function(){if(e.test(a(this).text())){a(this).show()}else{a(this).hide()}})});d.on("click","li",function(f){var e=a(this).closest(".selectbox").attr("data-multiple");if("true"==e){a(this).closest(".selectbox").find(".selectbox_input").append("<span class='multiple-select-ctx'><span>"+a(this).text()+"</span><span class='multiple-select-icon'>×</span></span>");a(this).hide()}else{a(this).closest(".selectbox").find(".selectbox_input").text(a(this).text())}a(this).closest(".selectbox_drop").hide();b.data("active","off")});a(".selectbox").on("click",".multiple-select-icon",function(f){a(this).parent().remove();var e=a(this).prevAll().text();d.find("li").each(function(){if(e==a(this).text()){a(this).show()}});f.stopPropagation()})}}}(jQuery));var dealerbox=(function($){function getDealerInfo(oDealerInput){var dealerNoOrMobile=$.trim(oDealerInput.value.replace("*",""));var onAfterInputAttr=oDealerInput.getAttribute("onAfterInput");var onAfterInput=null;if(onAfterInputAttr){onAfterInput=eval(onAfterInputAttr)}$("#dealerNo_"+oDealerInput.id).val("");$("#dealerName_"+oDealerInput.id).val("");$("#divDealerName_"+oDealerInput.id).hide();$("#divDealerType_"+oDealerInput.id).hide();$("#divMobile_"+oDealerInput.id).hide();if(onAfterInput){onAfterInput()}oDealerInput.setAttribute("dealerNo","");if(!dealerNoOrMobile){return false}var url=base+"/front/common/dealer/getDealerBase/"+dealerNoOrMobile;var dataUrl=oDealerInput.getAttribute("data-url");if(dataUrl){url=base+dataUrl+"/"+dealerNoOrMobile}var dealerInfo=null;$.get(url,function(datas){if(datas.success){if(datas.returnObject){if(datas.returnObject.dealer){dealerInfo=datas.returnObject.dealer}else{dealerInfo=datas.returnObject}}if(!dealerInfo){$("#dealerNo_"+oDealerInput.id).val("");$("#dealerName_"+oDealerInput.id).val("");showTips("您输入的手机号码或卡号不存在，请核对。",oDealerInput)}else{var isShowDealerType=oDealerInput.getAttribute("isshowdealertype");var isShowMobile=oDealerInput.getAttribute("isshowmobile");var isShowDealerNo=oDealerInput.getAttribute("isshowdealerno");$("#divMobile_"+oDealerInput.id).show();$("#divDealerName_"+oDealerInput.id).show();if(dealerNoOrMobile==dealerInfo.dealerNo||!isTrue(isShowDealerNo)){$("#divDealerName_"+oDealerInput.id).text(dealerInfo.fullName)}else{$("#divDealerName_"+oDealerInput.id).text((dealerInfo.fullName||"")+"("+dealerInfo.dealerNo+")")}$("#dealerNo_"+oDealerInput.id).val(dealerInfo.dealerNo);$("#dealerName_"+oDealerInput.id).val(dealerInfo.fullName);$("#certificateType_"+oDealerInput.id).val(dealerInfo.certificateType);$("#dealerType_"+oDealerInput.id).val(dealerInfo.dealerType);$("#divDealerType_"+oDealerInput.id).text(dealerInfo.dealerTypeLabel||"");$("#divMobile_"+oDealerInput.id).text(dealerInfo.contactMobile||"");if(isTrue(isShowDealerType)){$("#divDealerType_"+oDealerInput.id).show()}if(isTrue(isShowMobile)){$("#divMobile_"+oDealerInput.id).hide();if(dealerNoOrMobile==dealerInfo.dealerNo){$("#divMobile_"+oDealerInput.id).show()}}else{$("#divMobile_"+oDealerInput.id).hide()}if(isTrue(isShowDealerNo)){}oDealerInput.setAttribute("dealerNo",dealerInfo.dealerNo);if(onAfterInput){onAfterInput(dealerInfo.dealerNo,datas.returnObject)}var exp=new Date();exp.setTime(exp.getTime()+(24-exp.getHours())*60*60*1000-exp.getMinutes()*60*1000);document.cookie="dealerfullName="+encodeURIComponent(dealerInfo.fullName,"UTF-8")+";expires="+exp.toGMTString()+";path=/";document.cookie="dealerNoOrMobile="+dealerInfo.dealerNo+";expires="+exp.toGMTString()+";path=/"}}else{$("#dealerNo_"+oDealerInput.id).val("");$("#dealerName_"+oDealerInput.id).val("");showTips(datas.exceptionMessage,oDealerInput)}})}return{init:function(){var flag=1;$(".dealerbox").find(".dealerNoOrMobile").each(function(){var $this=$(this);if($this.val()){$this.change()}});$(".downMenuForDealer").click(function(){if($(this).next(".cookiedealerinfo").is(":hidden")){var flag=1}else{var flag=0}if(flag==1){var dealerNoOrMobile,dealerfullName,cookies=document.cookie.split(";");$.each(cookies,function(i,value){if(value.indexOf("dealerNoOrMobile")>0){dealerNoOrMobile=value.split("=")[1]}else{if(value.indexOf("dealerfullName")>0){dealerfullName=decodeURIComponent(value.split("=")[1],"UTF-8")}}});$(".cookiedealerinfo").hide();$(this).next(".cookiedealerinfo").width($(this).parents(".dealerNoDiv").find("input[type='text']").width()).show();if(dealerNoOrMobile){$(this).parents(".dealerNoDiv").find(".cookiedealerNo").attr("data-dealerNoOrMobile",dealerNoOrMobile).text(dealerfullName+"("+dealerNoOrMobile+")")}var $activeDealer=$(this).parents(".dealerNoDiv").find(".activeDealer"),activeDealerMount=$activeDealer.find(".dealerNo").length;if(activeDealerMount==0){$.get(base+"/front/so/query/listDealerHot",function(datas){if(datas.success){var data=datas.returnObject;if(data){var html=[];$.each(data,function(i,node){html.push("<span  class='dealerNo' style='font-size: 12px; cursor: pointer;' data-dealerNoOrMobile='"+node.dealerNo+"'>"+node.dealerName+"("+node.dealerNo+")</span><br/>")});$activeDealer.empty().append(html.join(""))}}else{ModalBox.alert(datas.exceptionMessage)}})}flag=0}else{if(flag==0){$(this).next(".cookiedealerinfo").hide();flag=1}}});$(".cookiedealerinfo").on("click",".dealerNo, .cookiedealerNo",function(){$(this).parents(".dealerNoDiv").find("input[type='text']").val($(this).attr("data-dealerNoOrMobile")).trigger("change");Validation.validateInput($(this).parents(".dealerNoDiv").find("input[type='text']")[0]);if(!$(this).attr("data-dealerNoOrMobile")){return false}$(this).parents(".cookiedealerinfo").hide();flag=1});$(".cookiedealerinfo").mouseleave(function(){$(this).hide();flag=1})},doDealerInputComplete:function(oDealerInput,e,eventType){if(!isDoEnterOrChange(oDealerInput,e,eventType)){return}var $Dealer=$(oDealerInput);oDealerInput.value=$.trim(oDealerInput.value.replace("*",""));if($Dealer.val()){var dealer=$Dealer.val().split(" ");if(dealer.length>0&&dealer[0]){var dealerNoOrMobile=$.trim(dealer[0]);if(dealerNoOrMobile.length!=9&&dealerNoOrMobile.length!=11){$("#dealerNo_"+oDealerInput.id).val(dealerNoOrMobile);$("#divDealerName_"+oDealerInput.id).hide();$("#divDealerType_"+oDealerInput.id).hide();$("#divMobile_"+oDealerInput.id).hide();oDealerInput.setAttribute("dealerNo","");showTips("请输入9位的卡号或11位的手机号码。",oDealerInput)}else{if(isNaN(dealerNoOrMobile)){showTips("请输入9位的卡号或11位的手机号码。",oDealerInput);return}var specialDealerNos=["000000000","999999999","777777777"];if(isIn(dealerNoOrMobile,specialDealerNos)){showTips("您不能使用卡号："+dealerNoOrMobile,oDealerInput)}else{avoidDuplicateCall(getDealerInfo,oDealerInput,e)}}}else{$("#dealerNo_"+oDealerInput.id).val("");$("#dealerName_"+oDealerInput.id).val("");$("#divDealerName_"+oDealerInput.id).hide();$("#divDealerType_"+oDealerInput.id).hide();$("#divMobile_"+oDealerInput.id).hide();oDealerInput.setAttribute("dealerNo","");var onAfterInputAttr=oDealerInput.getAttribute("onAfterInput");var onAfterInput=null;if(onAfterInputAttr){onAfterInput=eval(onAfterInputAttr)}if(onAfterInput){onAfterInput()}}}else{$("#dealerNo_"+oDealerInput.id).val("");$("#dealerName_"+oDealerInput.id).val("");$("#divDealerName_"+oDealerInput.id).hide();$("#divDealerType_"+oDealerInput.id).hide();$("#divMobile_"+oDealerInput.id).hide();oDealerInput.setAttribute("dealerNo","");var onAfterInputAttr=oDealerInput.getAttribute("onAfterInput");var onAfterInput=null;if(onAfterInputAttr){onAfterInput=eval(onAfterInputAttr)}if(onAfterInput){onAfterInput()}}}}}(jQuery));var addressbox=(function(b){function a(h){var f=h;var c=f.attr("data-url");if(!c){var d=f.attr("isLogin");var e=f.attr("data-poOrSo");var g="/front";if(d=="0"){g="/front/public"}if(e=="so"){c=base+g+"/common/soArea/listSoArea"}else{c=base+g+"/common/poArea/listPoArea"}}return c}return{dropdown:function(c){if(!b(".addressbox-drop").is(":hidden")){b(".addressbox-drop").hide();return}var e=b(c).closest(".addressbox");e.find(".addressbox-drop").show();var f=b(".addressbox-drop").not(e.find(".addressbox-drop"));if(!f.is(":hidden")){f.hide()}var d=e.find(".areaName").attr("id");console.log("complete1");if(e.find("[name='"+d+"addressPad1']").find("li")[0]){return}b.get(a(e),function(h){if(h.success){var g=h.returnObject;addressbox.appendAreas(e,g,1)}else{ModalBox.alert(h.exceptionMessage)}});return},clearAddress:function(f){var h=b(f).closest(".addressbox");var g=h.find(".areaName").attr("id");h.find(".areaName").val("");var c=h.find(".addrAreaCode");c.val("");c.removeAttr("level");c.removeAttr("effectiveDate");c.removeAttr("inactiveDate");c.removeAttr("zipCode");c.trigger("change");h.find(".tab-content a").removeClass("active");h.find("[name='"+g+"addressTab1']").find("a").click();for(var e=2;e<=4;e++){var d=h.find("[name='"+g+"addressPad"+(e)+"']").find("ul");d.empty();d.text(d.attr("data-prompt"))}if(typeof Validation!="undefined"){Validation.validateInput(h.find("input.areaName")[0])}b(f).hide()},appendAreas:function(h,e,c){if(e!=null){var k=h.find(".areaName").attr("id");var l=h.find("[name='"+k+"addressPad"+c+"']");var g=[];for(var f=0,d=e.length;f<d;f++){var j="<li onclick='addressbox.doOnSelect(this,\""+e[f].areaCode+'",'+c+")'";if(e[f].zipCode){j+="data-zipCode='"+e[f].zipCode+"'"}if(e[f].effectiveDate){j+="data-effectiveDate='"+e[f].effectiveDate+"'"}if(e[f].inactiveDate){j+="data-inactiveDate='"+e[f].inactiveDate+"'"}if(e[f].isMaxActive){j+="data-isMaxActive='"+e[f].isMaxActive+"'"}j+="><a href='javascript:void(0);' class='black'>"+e[f].areaDesc+"</a></li>";g.push(j)}l.find("ul").empty().append(g.join(""))}},doOnSelect:function(l,m,c,q,d){var o=b(l).closest(".addressbox");var s=o.find(".areaName").attr("id");var g=o.find(".addrAreaCode");g.val(m);g.attr("level",c);g.attr("effectiveDate",b(l).attr("data-effectiveDate"));g.attr("inactiveDate",b(l).attr("data-inactiveDate"));g.attr("isMaxActive",b(l).attr("data-isMaxActive"));g.attr("zipCode",b(l).attr("data-zipCode"));g.trigger("change");var k="";var p=o.find(".areaName").val();if(p){var r=p.split("/");for(var j=0;j<r.length;j++){if(j<c-1){if(k){k+="/"}k+=r[j]}}}if(k){k+="/"}k+=b(l).text();o.find(".areaName").val(k);o.find(".input-pad-clear").show();for(var j=c+1;j<=4;j++){var h=o.find("[name='"+s+"addressPad"+(j)+"']").find("ul");h.empty();h.text(h.attr("data-prompt"))}o.find("[name='"+s+"addressPad"+(c)+"']").find("a").removeClass("active");b(l).find("a").addClass("active");var f=o.find("[name='"+s+"addressTab"+(c+1)+"']");if(!f[0]){o.find(".addressbox-drop").hide();if(typeof Validation!="undefined"){Validation.validateInput(o.find("input.areaName")[0])}return}else{try{f.find("a").click()}catch(n){}b.get(a(o),{parentAreaCode:m,areaType:c+1},function(e){if(e.success){var i=e.returnObject;addressbox.appendAreas(o,i,c+1)}else{ModalBox.alert(e.exceptionMessage)}})}if(typeof Validation!="undefined"){Validation.validateInput(o.find("input.areaName")[0])}return false},init:function(){b(document).click(function(d){var c=b(d.target);if(!c.closest(".addressbox")[0]){b(".addressbox-drop").hide()}});b(".areaName").keydown(function(c){event.returnValue=false;event.preventDefault();event.stopPropagation()});b(".areaName").on("paste",function(c){c.preventDefault();c.result=null})}}}(jQuery));var autocompletebox=(function(a){return{init:function(){a(".autocompletebox .dropdown-menu").find("a").each(function(){a(this).attr("data-srctext",a(this).text());a(this).attr("data-completeText",a(this).text());a(this).on("click",function(){var b=a(this).closest(".autocompletebox").find(".dropdown-toggle");b.val(a(this).text());b.closest(".autocompletebox").find(".dropdown-menu").hide();if(typeof Validation!="undefined"){Validation.validateInput(b[0])}})})},hideOption:function(b){a(b).closest(".autocompletebox").find(".dropdown-menu").hide()},showOption:function(h,e,b){var i=a(h);var c=i.closest(".autocompletebox").find(".dropdown-menu");var g=i.val();if(e=="focus"){if(!g){i.dropdown();c.find("a").each(function(){var k=a(this);var j=k.attr("data-completeText");k.html(j);k.show()});c.show()}}else{if(!g){c.hide();return}}if(g){if(e!="focus"&&e!="keyup"){if(g.indexOf(e)>=0){c.find("a").each(function(){var k=g.split(e);var j=k[0]+e+a(this).attr("data-srctext");a(this).attr("data-completeText",j);a(this).html(j)})}else{c.hide();return}}var d=false;c.find("a").each(function(){var k=a(this);var j=k.attr("data-completeText");console.log(j+","+g);if(j.indexOf(g)>=0){console.log("show");j=j.replace(g,"<b>"+g+"</b>");k.html(j);d=true;k.show()}else{console.log("hide");k.hide()}});if(d){i.dropdown();c.show()}else{c.hide()}}if(b.which==40){var f=c.find("a:visible")[0];if(f){f.focus()}}}}}(jQuery));var searchbox=(function(a){return{init:function(){}}}(jQuery));var fixedtool=(function(b){var a;return{init:function(){var l=200;var k=document.body.clientWidth-1150;var f=b("#fixedtool_pad").find(".fixedtool-btn").length;var c=(f*44+1)+"px";var j=((f-1)*44+1)+"px";var h=b("#fixedtool_pad").find(".fixedtool-btn:visible");for(var d=0;d<h.length;d++){b(h[d]).css("top",(d*44)+"px")}b(".fixedtool-btn[name='backToTop']").css("top",(h.length*44)+"px");b("#fixedtool_pad").css("right",k/2-50+"px");if(b("#isshowfixedtool").val()=="fixedtool"){b("#fixedtool_pad").css("height",j).css("width","45px");b(window).scroll(function(){if(b(window).scrollTop()>=l){b("#fixedtool_pad").find("a[name='backToTop']").show();b("#fixedtool_pad").css("height",c).css("width","45px")}else{b("#fixedtool_pad").find("a[name='backToTop']").hide();b("#fixedtool_pad").css("height",j).css("width","45px")}})}else{b(window).scroll(function(){if(b(window).scrollTop()>=l){b("#fixedtool_pad").find("a[name='backToTop']").css("top",0).show();b("#fixedtool_pad").css("height",c).css("width","45px")}else{b("#fixedtool_pad").find("a[name='backToTop']").hide();b("#fixedtool_pad").css("height",j).css("width","0px")}})}b(window).resize(function(){k=document.body.clientWidth-1150;if(k<=60){b("#fixedtool_pad").css("right","0px")}else{b("#fixedtool_pad").css("right",k/2-50+"px")}});b("#fixedtool_pad").find("a[name='backToTop']").click(function(){b(window).scrollTop(0)});b(".fixedtool-btn").hover(function(){if(b(this).attr("title")=="去购物车"){b(this).find("i").hide().end().find("span:first").text(b(this).attr("title")).end().find("span:last").hide()}else{b(this).find("i").hide().end().find("span").text(b(this).attr("title"))}},function(){if(b(this).attr("title")=="去购物车"){b(this).find("span:first").text("").end().find("i").show().end().find("span:last").show()}else{b(this).find("span").text("").end().find("i").show()}});try{if(b("a[name='shoppingCart']").length>0){this.onShoppingCartTotalQtyChange(base)}}catch(g){}},onShoppingCartChange:function(c){if(c){var d=b("#cartTips");var e=b("[name='shoppingCart']");if(b("[name='backToTop']").is(":hidden")){d.css("bottom","266px")}else{d.css("bottom","310px")}d.css("left",e.offset().left);d.find(".productShortName").text(c.productShortName);d.find(".qty").text(c.qty);d.find(".productPrice").text(formatMoney(c.productPrice*c.qty,true));d.find("img").attr("src",c.pcListPhotoId);d.show();if(a){clearTimeout(a)}d.animate({left:(e.offset().left-d.width()-22)},500);a=setTimeout(function(){d.hide(0);if(!_dealerNo){window.location.reload()}},1000)}},setCartTotalCount:function(d,c){if(!_dealerNo||typeof(c)=="undefined"||isNaN(c)){b("#fixedtool_pad").find(".total-qty").text("")}else{var e=getGbssCookie(_dealerNo+"_cartSize");if(e){setGbssCookie(dealerNo+"_cartSize",c,1);if(c>999){c=c.substring(0,4)+"..."}b("#fixedtool_pad").find(".total-qty").text(c)}else{this.onShoppingCartTotalQtyChange(d)}}},addCartTotalCount:function(c,d){if(!_dealerNo||typeof(d)=="undefined"||isNaN(d)){b("#fixedtool_pad").find(".total-qty").text("")}else{var e=getGbssCookie(_dealerNo+"_cartSize");if(e){e=Number(e)+Number(d);setGbssCookie(_dealerNo+"_cartSize",e,1);if(e>999){e=e.substring(0,4)+"..."}b("#fixedtool_pad").find(".total-qty").text(e)}else{this.onShoppingCartTotalQtyChange(c)}}},onShoppingCartTotalQtyChange:function(c,e){var d=c+"/front/public/shoppingCart/getProductTotalCount";if(e){d+="?dealerNo="+e}b.get(d,function(f){if(f.exceptionMessage){ModalBox.alert(f.exceptionMessage)}else{var g=f.returnObject;if(typeof(_dealerNo)=="undefined"||isNaN(g)){b("#fixedtool_pad").find(".total-qty").text("0")}else{b("#fixedtool_pad").find(".total-qty").text(g);setGbssCookie(_dealerNo+"_cartSize",g,1);if(g>999){g=g.substring(0,4)+"..."}b("#fixedtool_pad").find(".total-qty").text(g)}}})}}}(jQuery));var pagination=(function($){var pageRows;return{doPageSearch:function(url,formId,resultId,pageNumber,sortFieldName,sortDirection,doOnBeforSearch,oBtn){var index=url.indexOf("?");var tagName=oBtn.tagName;if(tagName=="SELECT"){pagination.pageRows=$(oBtn).val()}else{if(typeof(pagination.pageRows)=="undefined"){pagination.pageRows=10}}if(index<0){url+="?page="+pageNumber+"&rows="+pagination.pageRows}else{if(index==url.length-1){url+="page="+pageNumber+"&rows="+pagination.pageRows}else{url+="&page="+pageNumber+"&rows="+pagination.pageRows}}var doOnBeforSearchFunc=null;if(doOnBeforSearch){doOnBeforSearchFunc=eval(doOnBeforSearch)}doSearch(url,formId,resultId,doOnBeforSearchFunc,oBtn);$(document).scrollTop(0);console.log()},showRows:function(url,formId,resultId,doOnBeforSearch,oBtn){pagination.doPageSearch(url,formId,resultId,1,null,null,doOnBeforSearch,oBtn)}}}(jQuery));var showmore=(function(a){return{toggle:function(f,e,b,c){var d=a(f);if(d.data("active")!="on"){a("."+c).css("display","");d.find(".moretext").text(b);d.find(".moreicon").find("i.fa").attr("class","fa fa-angle-up");d.data("active","on")}else{a("."+c).css("display","none");d.find(".moretext").text(e);d.find(".moreicon").find("i.fa").attr("class","fa fa-angle-down");d.data("active","off")}}}}(jQuery));var idcardbox=(function(b){function a(f){var d=b(f);if(d.attr("cardtype")=="01"){var c=d.val();var e=formatIdcardNo(c);if(f.value){showFormat(e,f)}else{hideFormat(e,f)}}}return{init:function(){var c=b(".idcardbox").find("input");c.keyup(function(){a(this)}).blur(function(){hideFormat(this)});c.mouseenter(function(){a(this)}).mouseleave(function(){hideFormat(this)});c.change(function(){c.val(c.val().toUpperCase())})}}}(jQuery));var echeckbox=(function($){return{doOnClick:function(oThat){var $that=$(oThat);var $checkbox=$that.find("input.echeckbox-input");var onbeforecheck=$checkbox.attr("onbeforecheck");if(onbeforecheck){var onbeforecheckFunc=eval(onbeforecheck);var canCheck=onbeforecheckFunc($checkbox[0]);if(!canCheck){return}}var type=$checkbox.attr("type");if(type.toUpperCase()=="RADIO"){var name=$checkbox.attr("name");if(name){$("input[name='"+name+"']").each(function(){var $pad=$(this).closest(".echeckbox");$pad.removeClass("echeckbox-checked");$pad.find("#tick").hide();$(this).prop("checked",false)})}$that.addClass("echeckbox-checked");$checkbox.prop("checked",true);$that.find("#tick").show()}else{if($checkbox.prop("checked")){$checkbox.prop("checked",false);$that.find("#tick").hide();$that.removeClass("echeckbox-checked")}else{$checkbox.prop("checked",true);$that.find("#tick").show();$that.addClass("echeckbox-checked")}}},doOnMouseover:function(oThat){var $that=$(oThat);$that.addClass("echeckbox-over")},doOnMouseout:function(oThat){var $that=$(oThat);$that.removeClass("echeckbox-over")},discheckAll:function(name,callbackFunc){$("input[name='"+name+"']").each(function(){var $pad=$(this).closest(".echeckbox");$pad.removeClass("echeckbox-checked");$pad.find("#tick").hide();$(this).prop("checked",false);if(callbackFunc){callbackFunc(this)}})},clickPad:function(oCheckbox){$(oCheckbox).parent().click()}}}(jQuery));var mobilebox=(function(a){function b(e){var d=a(e);var c=d.val();var f=formatMobile(c);if(e.value){showFormat(f,e)}else{hideFormat(f,e)}}return{init:function(){var c=a(".mobilebox").find("input");c.keyup(function(){b(this)}).blur(function(){hideFormat(this)});c.mouseenter(function(){b(this)}).mouseleave(function(){hideFormat(this)})}}}(jQuery));var bankaccountbox=(function(a){return{doBankAccountNoKeyup:function(e){var d=a(e);var b=a.trim(d.val());var c=formatBankAccountNo(b);if(e.value){showFormat(c,e)}else{hideFormat(c,e)}}}}(jQuery));var banknobox=(function(b){function a(e){var d=b(e);var c=b.trim(d.val());var f=c.substr(0,4);if(c.length>4){f+=" "+c.substr(4,4);if(c.length>8){f+=" "+c.substr(8,4);if(c.length>12){f+=" "+c.substr(12,4);if(c.length>16){f+=" "+c.substr(16,4);if(c.length>20){f+=" "+c.substr(20,4)}}}}}if(e.value){showFormat(f,e)}else{hideFormat(f,e)}}return{init:function(){var c=b(".banknobox").find("input");c.keyup(function(){a(this)}).blur(function(){hideFormat(this)});c.mouseenter(function(){a(this)}).mouseleave(function(){hideFormat(this)})}}}(jQuery));var datebox=(function(a){return{init:function(){if(a(".datetimepicker-date").datetimepicker){a(".datetimepicker-date").datetimepicker({todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,format:DATE_FORMAT}).on("changeDate",function(b){if(typeof Validation!="undefined"){Validation.validateInput(a(this).find("input")[0])}})}},doOnChange:function(c){var f=a(c);var b=a.trim(f.val());if(!b||b.indexOf("-")>=0){return}var d=getYearMonthDay(b);if(!d){return}var e=formatDate(d.year,d.month,d.day);if(e){f.val(e)}},doPrev:function(c){var f=a(c).next().find("input[type='text']");if(!f.val()){f.val(formatDate2(new Date()));if(typeof Validation!="undefined"){Validation.validateInput(f[0])}return}var b=f.val();var e=getYearMonthDay(b);if(e){var d=new Date();d.setYear(e.year);d.setMonth(e.month-1);d.setDate(e.day-1);f.val(formatDate2(d))}if(typeof Validation!="undefined"){Validation.validateInput(f[0])}},doNext:function(c){var f=a(c).prev().find("input[type='text']");if(!f.val()){f.val(formatDate2(new Date()));if(typeof Validation!="undefined"){Validation.validateInput(f[0])}return}var b=f.val();var e=getYearMonthDay(b);if(e){var d=new Date();d.setYear(e.year);d.setMonth(e.month-1);d.setDate(e.day+1);f.val(formatDate2(d))}if(typeof Validation!="undefined"){Validation.validateInput(f[0])}}}}(jQuery));var datetimebox=(function(a){var b="yyyy-mm-dd hh:ii:ss";return{init:function(){if(a(".datetimepicker-all").datetimepicker){a(".datetimepicker-all").datetimepicker({weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,showMeridian:1,format:b}).on("changeDate",function(c){if(typeof Validation!="undefined"){Validation.validateInput(a(this).find("input")[0])}})}}}}(jQuery));var timer=(function($){var _minute=10;var _second=0;var _$timer=null;function calcTime(){if(_second==0){if(_minute>0){_second=59;_minute--}}else{_second--}var minuteStr=_minute>9?_minute:"0"+_minute;var secondStr=_second>9?_second:"0"+_second;_$timer.text(minuteStr+"分"+secondStr+"秒");if(_minute>0||_second>0){setTimeout(calcTime,1000)}else{var onstop=_$timer.attr("onstop");var onstopFunc=eval(onstop);if(onstopFunc){onstopFunc()}}}function startTimer(){calcTime()}return{init:function(){_$timer=$("#timer");if(_$timer[0]){var time=_$timer.attr("data-time")*1;var timeunit=_$timer.attr("data-timeunit");var seconds=0;if(timeunit=="TIME"){var tUrl=base+"/public/status/f5";var timeNow=new Date($.ajax({url:tUrl,async:false,timeout:500}).getResponseHeader("Date"));seconds=Math.floor((time-timeNow.getTime())/1000)}else{if(timeunit=="SECOND"){seconds=time}else{if(timeunit=="MUNITE"){seconds=time*60}}}if(seconds>0){_minute=Math.floor(seconds/60);_second=seconds%60;startTimer()}else{_minute=0;_second=0;_$timer.text("00分00秒");var onstop=_$timer.attr("onstop");var onstopFunc=eval(onstop);if(onstopFunc){onstopFunc()}}}}}}(jQuery));var smsbox=(function(f){var d="";var e=60;var a=false;function b(){var h=f("#btnSendValidCode");e--;if(e>0){h.attr("disabled",true);var g=e>9?e:"0"+e;h.text("重新获取验证码（"+g+"秒）");setTimeout(b,1000)}else{h.attr("disabled",false);h.text("重新获取验证码");f("#spanSendTips").hide();e=60;if(typeof Validation!="undefined"){Validation.hideTips(f(".smsbox_input")[0])}}}function c(g){f(g).attr("disabled",true);f(g).text("重新获取验证码（60秒）");b()}return{sendSms:function(l,h,k,j,g){if(l){if(typeof Validation!="undefined"){Validation.hideTips(f(".smsbox_input")[0])}if(j=="*"){j="/front/common/dealer/sendSMSVaildCode/"+h+"/"+l+"/"+k}else{j=j+"/"+h+"/"+k}var i=base+j;f(g).attr("disabled",true);f("#spanValidPass").hide();f("#spanValidNotPass").hide();f("#spanSendTips").hide();f.get(i,function(m){if(m.success){f("#spanSendTips").show();c(g)}else{showTips(m.exceptionMessage,g);f(g).attr("disabled",false)}})}},doOnValidCodeChange:function(m,g,l,k){var i=f(k).val().length;if(i>=6||i==0){f("#spanSendTips").hide();a=false;var j=f.trim(k.value);if(j){var h=base+"/front/common/public/checkValidCode/"+g+"/"+m+"/"+j+"/"+l;f.get(h,function(n){if(n.success){if(n.returnObject){a=true;f("#spanValidPass").show();f("#spanValidNotPass").hide();e=0}else{f("#spanValidPass").hide();f("#spanValidNotPass").show()}}else{showTips(n.exceptionMessage,k)}})}else{showTips("请输入验证码。",k);f("#btnSendValidCode").nextAll().hide()}}},isPass:function(){return a}}}(jQuery));var smsmultibox=(function(f){var d="";var e=60;var a=false;function b(){var h=f("#btnSendValidCode2");e--;if(e>0){h.attr("disabled",true);var g=e>9?e:"0"+e;h.text("重新获取验证码（"+g+"秒）");setTimeout(b,1000)}else{h.attr("disabled",false);h.text("重新获取验证码");f("#spanSendTips2").hide();e=60;if(typeof Validation!="undefined"){Validation.hideTips(f(".smsbox_input")[0])}}}function c(g){f(g).attr("disabled",true);f(g).text("重新获取验证码（60秒）");b()}return{sendSms:function(l,j,k,n,o,h){if(l){if(typeof Validation!="undefined"){Validation.hideTips(f(".smsbox_input")[0])}var m="";if(o=="*"){o="/front/common/dealer/sendSMSVaildCode/"+k+"/"+l+"/"+n;m="/front/common/dealer/sendSMSVaildCode/"+k+"/"+j+"/"+n}else{o=o+"/"+k+"/"+n;m=m+"/"+k+"/"+n}var g=base+o;var i=base+m;f(h).attr("disabled",true);f("#spanValidPass2_1").hide();f("#spanValidNotPass2_1").hide();f("#spanSendTips2_1").hide();f("#spanValidPass2_2").hide();f("#spanValidNotPass2_2").hide();f("#spanSendTips2_2").hide();f.get(g,function(p){if(p.success){f.get(i,function(q){if(q.success){f("#spanSendTips2_2").show();f("#spanSendTips2_1").show();c(h)}else{showTips(p.exceptionMessage,h);f(h).attr("disabled",false)}})}else{showTips(p.exceptionMessage,h);f(h).attr("disabled",false)}})}},doOnValidCodeChange:function(m,g,l,k){var i=f(k).val().length;if(i>=6||i==0){f("#spanSendTips2_1").hide();a=false;var j=f.trim(k.value);if(j){var h=base+"/front/common/public/checkValidCode/"+g+"/"+m+"/"+j+"/"+l;f.get(h,function(n){if(n.success){if(n.returnObject){a=true;f("#spanValidPass2_1").show();f("#spanValidNotPass2_1").hide();e=0}else{f("#spanValidPass2_1").hide();f("#spanValidNotPass2_1").show()}}else{showTips(n.exceptionMessage,k)}})}else{showTips("请输入验证码。",k);f("#btnSendValidCode2_1").nextAll().hide()}}},doOnValidCodeChange2:function(m,g,l,k){var i=f(k).val().length;if(i>=6||i==0){f("#spanSendTips2_2").hide();a=false;var j=f.trim(k.value);if(j){var h=base+"/front/common/public/checkValidCode/"+g+"/"+m+"/"+j+"/"+l;f.get(h,function(n){if(n.success){if(n.returnObject){a=true;f("#spanValidPass2_2").show();f("#spanValidNotPass2_2").hide();e=0}else{f("#spanValidPass2_2").hide();f("#spanValidNotPass2_2").show()}}else{showTips(n.exceptionMessage,k)}})}else{showTips("请输入验证码。",k);f("#btnSendValidCode2").nextAll().hide()}}},isPass:function(){return a}}}(jQuery));var selectProductBasicDialog=(function($){function filterProductFun(listTypeCode,productKey){$("#tbodyProductInfo tr").each(function(){var $tr=$(this),productcode=$tr.attr("data-productcode"),listtypecode=$tr.attr("data-listtypecode"),parentlisttypeCode=$tr.attr("data-parentlisttypeCode"),productpinyin=$tr.attr("data-productpinyin"),productshortname=$tr.attr("data-productshortname"),productfullname=$tr.attr("data-productfullname");if(listTypeCode){if(listTypeCode==listtypecode||listTypeCode==parentlisttypeCode){$tr.css("display","table-row")}else{$tr.css("display","none")}return}if(productKey){productKey=$.trim(productKey);if(productcode.indexOf(productKey)!=-1||productfullname.indexOf(productKey)!=-1||productshortname.indexOf(productKey)!=-1||productpinyin.indexOf(productKey)!=-1){$tr.css("display","table-row")}else{$tr.css("display","none")}return}});if($("#tbodyProductInfo tr[style='display: table-row;']").length==0){$("#showInfo").show();$("#divProductInfo").hide()}else{$("#showInfo").hide();$("#divProductInfo").show()}}function closeDialogFun(){$("#colseModal").click()}return{init:function(){var productType=$("#productType").val(),$this;if(productType==="M"){$this=$("#divListTypeM").find("ul li:first")}else{$this=$("#divListTypeP").find("ul li:first")}if($this){$this.find("a").click()}},filterProductByProductType:function(productType){var $this=$("#divListType"+productType).find("ul li:first");if($this){$this.find("a").click()}},filterProductByListTypeCode:function(aListType,listTypeCode){var $listType=$(aListType);var id=$listType.attr("href");if(id!="#none"){$(id).find("li").each(function(){var $li=$(this);$li.removeClass("active")})}filterProductFun(listTypeCode,null)},searchProductKey:function(o,event){var thisType=$(o).attr("type");if((thisType=="text"&&event.keyCode==13)||(thisType=="button")){filterProductFun(null,$("#screenProductKey").val())}},clickCheckboxFun:function(o){if($(o).attr("checked")){$(o).prop("checked",false);$(o).attr("checked",false)}else{$(o).prop("checked",true);$(o).attr("checked",true)}},clickRadioBoxFun:function(o){var products=[];var $tr=$(o).parents("tr"),productcode=$tr.attr("data-productcode"),productshortname=$tr.attr("data-productshortname"),productfullname=$tr.attr("data-productfullname"),productprice=$tr.attr("data-productprice"),productRetailPrice=$tr.attr("data-productRetailPrice"),productpoint=$tr.attr("data-productpoint"),unitmeasure=$tr.attr("data-unitmeasure");var product={productCode:productcode,productFullName:productfullname,productShortName:productshortname,productQty:1,productPrice:productprice,productRetailPrice:productRetailPrice,productPoint:productpoint,unitMeasure:unitmeasure};products.push(product);var onCallBackchange=$(o).attr("onCallBackchange");if(onCallBackchange){var onCallBackchangeFunc=eval(onCallBackchange);if(onCallBackchangeFunc){var returnStatus=onCallBackchangeFunc(products,$("#htmlControl").val());if(returnStatus){closeDialogFun()}}}},selectProductCallBack:function(o){var products=[];$(".rcheckbox-input:checked").each(function(){var $tr=$(this).parents("tr"),productcode=$tr.attr("data-productcode"),productshortname=$tr.attr("data-productshortname"),productfullname=$tr.attr("data-productfullname"),productprice=$tr.attr("data-productprice"),productRetailPrice=$tr.attr("data-productRetailPrice"),productpoint=$tr.attr("data-productpoint"),unitmeasure=$tr.attr("data-unitmeasure");var product={productCode:productcode,productFullName:productfullname,productShortName:productshortname,productQty:1,productPrice:productprice,productRetailPrice:productRetailPrice,productPoint:productpoint,unitMeasure:unitmeasure};products.push(product)});if(products.length==0){ModalBox.alert("请选择需要添加的产品！")}else{var onCallBackchange=$(o).attr("onCallBackchange");if(onCallBackchange){var onCallBackchangeFunc=eval(onCallBackchange);if(onCallBackchangeFunc){var returnStatus=onCallBackchangeFunc(products,$("#htmlControl").val());if(returnStatus){closeDialogFun()}}}}},closeDialog:function(){closeDialogFun()}}}(jQuery));var productbox=(function(a){return{showMore:function(b){a(b).find("[name='divFav']").show()},hideMore:function(c,b){a(c).find("[name='divFav']").hide()},addDealerFavFun:function(b){},delDealerFavFun:function(b){a(b).children(".heart").text("收藏")}}}(jQuery));var sharebox=(function(a){return{init:function(){a("#sharebox_share_div").share()}}}(jQuery));var showImages=(function(a){return{showImage:function(b){if(a("#imageboxModal")){a("#imageboxModal").find("img").attr("src",b);a("#imageboxModal").modal({keyboard:false,show:true})}}}}(jQuery));var imgUploadBox=(function($){var _rootFolder;var _path;var showOrHideDiv=function(divId){var _this=$("#"+divId);var _parent=$("#"+_this.attr("refDivId"));if(_parent.find(".subImgUploadBoxDiv").length<_parent.attr("maxCount")){_this.show()}else{_this.hide()}};var createPhotoBox=function(divId){var _this=$("#"+divId);var _parent=$("#"+_this.attr("refDivId"));if(_parent.find(".subImgUploadBoxDiv").length<_parent.attr("maxCount")){_this.show()}else{_this.hide()}};var showPhoto=function(pathInputId){$("#img_add_"+pathInputId).hide();$("#img_"+pathInputId).show();$("#imgUploadBox_"+pathInputId).attr("select","1")};var hidePhoto=function(pathInputId){$("#img_add_"+pathInputId).show();$("#img_"+pathInputId).hide();$("#imgUploadBox_"+pathInputId).attr("select","0")};return{uploadImpl:function(formData,pathInputId,storageHost,rootFolder,base,path,frontOrAdmin,onuploaded){showLoading();jQuery.ajax({url:storageHost+"/upload/",type:"POST",processData:false,contentType:false,data:formData,success:function(datas){hideLoading();var curDate=new Date();var imgUrl=storageHost+"/bucket/"+rootFolder+"/"+path+"?t="+curDate.getTime();showTips("上传成功。",$("#imgUploadBox_"+pathInputId)[0]);if(rootFolder.indexOf("private")>=0){$.get(base+"/"+frontOrAdmin+"/storage/signStorageUrl?url="+encodeURIComponent(imgUrl),function(datas){if(datas.success){var urlSigned=datas.returnObject;$("#img_"+pathInputId).attr("src",urlSigned);$("#img2_"+pathInputId).attr("src",urlSigned)}})}else{$("#img_"+pathInputId).attr("src",imgUrl);$("#img2_"+pathInputId).attr("src",imgUrl)}$("#"+pathInputId).val(rootFolder+"/"+path+"?t="+curDate.getTime());$("#file_"+pathInputId).val(null);showPhoto(pathInputId);var _parent=$(".subImgUploadBoxDiv[pathinputid='"+pathInputId+"']");if(_parent.length==1){var __parent=_parent.parent();var size=__parent.find(".subImgUploadBoxDiv").length;var maxCount=__parent.attr("maxCount");if(size<maxCount){imgUploadBox.createBox(__parent.attr("parentId"),__parent.attr("pathInputId"),"")}}if(onuploaded){var onuploadedFunc=eval(onuploaded);if(onuploadedFunc){onuploadedFunc()}}},error:function(xhr){hideLoading();var returnObject=JSON.parse(xhr.responseText);ModalBox.alert("<br/>上传图片失败，资源中心提示：<br/>"+returnObject.message);console.log("上传图片失败：path="+path+", token="+token)}})},upload:function(oBtn,pathInputId,rootFolder,path,storageHost,frontOrAdmin,isNeedExtName,onuploaded,onlyAllowUploadPic,isNeedCompress){if($("#file_"+pathInputId).val()==""){return}var $this=this;var file=$("#file_"+pathInputId)[0].files[0];if(!file){return}var fName=file.name;if(onlyAllowUploadPic=="true"){if(fName){if(!/.(GIF|JPG|JPEG|PNG|GIF|PNG|BMP|TIFF)$/.test(fName.toUpperCase())){ModalBox.alert("只能上传图片");return false}}}if(_rootFolder){rootFolder=_rootFolder}if(_path){path=_path}var tokenIndex=path.indexOf("&token=");if(tokenIndex<0){tokenIndex=path.indexOf("?token=")}if(tokenIndex>0){path=path.substring(0,tokenIndex)}if(isNeedExtName=="1"||isNeedExtName=="true"){var extName=null;var fileName=$("#file_"+pathInputId).val();if(fileName){var arr=fileName.split(".");if(arr.length>0){extName=arr[arr.length-1]}}if(extName){path+=path+"."+extName}}$.get(base+"/"+frontOrAdmin+"/storage/getToken?rootFolder="+rootFolder,function(datas){if(datas.success){var token=datas.returnObject;var formData=new FormData();formData.append("key",path);formData.append("token",token);var fileSize=(file.size)/(1024*1024);if(fileSize<0.8){formData.append("file",file);$this.uploadImpl(formData,pathInputId,storageHost,rootFolder,base,path,frontOrAdmin,onuploaded);return}if(isNeedCompress=="true"){if(typeof(FileReader)==="undefined"){formData.append("file",file);$this.uploadImpl(formData,pathInputId,storageHost,rootFolder,base,path,frontOrAdmin,onuploaded)}else{$this.doDase64(file,function(base64Data){var blob=$this.getBlob(base64Data,file.type);if(blob&&blob.size>0){if(isIE()){formData.append("file",blob,fName)}else{var tempfile=new File([blob],fName);formData.append("file",tempfile)}}else{formData.append("file",file)}$this.uploadImpl(formData,pathInputId,storageHost,rootFolder,base,path,frontOrAdmin,onuploaded)})}}else{formData.append("file",file);$this.uploadImpl(formData,pathInputId,storageHost,rootFolder,base,path,frontOrAdmin,onuploaded)}}})},deleteImpl:function(pathInputId,noPhoto){var _parent=$(".subImgUploadBoxDiv[pathinputid='"+pathInputId+"']");if(_parent.length==1){var __parent=_parent.parent();var size=__parent.find(".subImgUploadBoxDiv").length;if(size>1){_parent.remove();var maxCount=__parent.attr("maxCount");if(size<=maxCount){if(__parent.find("[select='0']").length==0){imgUploadBox.createBox(__parent.attr("parentId"),__parent.attr("pathInputId"),"")}}}else{$("#"+pathInputId).val("");$("#img_"+pathInputId).attr("src",noPhoto);$("#img2_"+pathInputId).attr("src",noPhoto);hidePhoto(pathInputId)}}else{$("#"+pathInputId).val("");$("#img_"+pathInputId).attr("src",noPhoto);$("#img2_"+pathInputId).attr("src",noPhoto);hidePhoto(pathInputId)}},delUploadPhoto:function(pathInputId,noPhoto,isNeedRemoveWarning,onlyAllowUploadPic){var _this=this;if(isNeedRemoveWarning=="true"){var messageText="确定要删除吗?";if(onlyAllowUploadPic=="true"){messageText="是否确定删除照片?"}ModalBox.confirm({title:"请您确认",size:"small",message:messageText,callback:function(result){if(result){_this.deleteImpl(pathInputId,noPhoto)}}})}else{_this.deleteImpl(pathInputId,noPhoto)}},getBlob:function(base64Data,fileType){try{var $this=this;if(base64Data&&base64Data.length>0&&base64Data.indexOf(",")!=-1){var text=window.atob(base64Data.split(",")[1]);var buffer=new Uint8Array(text.length);var pecent=0,loop=null;for(var i=0;i<text.length;i++){buffer[i]=text.charCodeAt(i)}var blob=$this.getBlobImpl([buffer],fileType);return blob}return null}catch(e){return null}},getBlobImpl:function(buffer,format){try{return new Blob(buffer,{type:format})}catch(e){var bb=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder);buffer.forEach(function(buf){bb.append(buf)});return bb.getBlob(format)}},uploadToMongoImpl:function(formData,pathInputId,url,photoLoadUrl,baseUrl){showLoading();jQuery.ajax({url:url,type:"POST",processData:false,contentType:false,data:formData,success:function(datas){hideLoading();var mongoID="";var datas=JSON.parse(datas);if(datas.success){if(datas.photoMap!=null){mongoID=datas.photoMap.photoId}if(mongoID){var imgUrl=baseUrl+photoLoadUrl+"/"+mongoID;$("#img_"+pathInputId).attr("src",imgUrl);$("#img2_"+pathInputId).attr("src",imgUrl);$("#"+pathInputId).val(mongoID+";"+pathInputId)}}},error:function(xhr){hideLoading();var returnObject=JSON.parse(xhr.responseText);ModalBox.alert("<br/>上传图片失败<br/>")}})},uploadToMongo:function(pathInputId,uploadAction,photoLoadUrl,frontOrAdmin,isNeedCompress){var $this=this;var baseUrl=base+"/"+frontOrAdmin+"/";var url=baseUrl+uploadAction;var file=$("#file_"+pathInputId)[0].files[0];if(!file){return}var fileName=file.name;if(!/.(GIF|JPG|JPEG|PNG|GIF|PNG|BMP|TIFF)$/.test(fileName.toUpperCase())){ModalBox.alert("只能上传图片");return false}var formData=new FormData();var fileSize=(file.size)/(1024*1024);if(fileSize<0.8){formData.append("photo",file);$this.uploadToMongoImpl(formData,pathInputId,url,photoLoadUrl,baseUrl);return}if(isNeedCompress=="true"){if(typeof(FileReader)==="undefined"){formData.append("photo",file);$this.uploadToMongoImpl(formData,pathInputId,url,photoLoadUrl,baseUrl)}else{$this.doDase64(file,function(base64Data){var blob=$this.getBlob(base64Data,file.type);if(blob&&blob.size>0){if(isIE()){formData.append("photo",blob,fileName)}else{var tempfile=new File([blob],fileName);formData.append("photo",tempfile)}}else{formData.append("photo",file)}$this.uploadToMongoImpl(formData,pathInputId,url,photoLoadUrl,baseUrl)})}}else{formData.append("photo",file);$this.uploadToMongoImpl(formData,pathInputId,url,photoLoadUrl,baseUrl)}},setParam:function(rootFolder,path){_rootFolder=rootFolder;_path=path},showMore:function(_this){if($(_this).attr("select")=="1"){$(_this).find(".displayPad").show()}$(_this).find(".displayPad2").show()},hideMore:function(_this){$(_this).find(".displayPad,.displayPad2").hide()},openFile:function(pathInputId){$("#file_"+pathInputId).click()},createBox:function(id,pathInputId,imgsrc,imgsrcValue){var mutilImgUploadBoxDiv=$("#mutilImgUploadBoxDiv_"+id);var tmplMutilImgUploadBox=$("#tmplMutilImgUploadBox_"+id);var index=parseInt(mutilImgUploadBoxDiv.attr("curIndex"));if(imgsrc!=""){var arrImgsrc=imgsrc.split(",");var arrImgSrcValue=imgsrcValue.split(",");for(var i=0,n=arrImgsrc.length;i<n;i++){if(arrImgsrc[i]!=""){var obj={index:index,subPathInputId:pathInputId+"_"+index,imgsrc:arrImgsrc[i],subImgSrcValue:arrImgSrcValue[i]};mutilImgUploadBoxDiv.append(tmplMutilImgUploadBox.tmpl(obj));index++}}}else{var subPathInputId=pathInputId+"_"+index;var obj={index:index,subPathInputId:subPathInputId};mutilImgUploadBoxDiv.append(tmplMutilImgUploadBox.tmpl(obj));hidePhoto(subPathInputId);index++}mutilImgUploadBoxDiv.attr("curIndex",index)},init:function(){$(".mutilImgUploadBox").each(function(){var _this=$(this);imgUploadBox.createBox(_this.attr("parentId"),_this.attr("pathInputId"),_this.attr("initImgSrc"),_this.attr("initImgSrcValue"));if(_this.attr("initImgSrc")!=""){var size=_this.find(".subImgUploadBoxDiv").length;var maxCount=_this.attr("maxCount");if(size<maxCount){imgUploadBox.createBox(_this.attr("parentId"),_this.attr("pathInputId"),"")}}})},rotateImg:function(btn,operate,defaultValue){var $img=$(btn).parent().parent().find("img");var angle=this.calculateAngle(btn,operate,defaultValue);this.setMaxWidth($img,angle);$img.rotate({angle:angle});$(btn).parent().find(".rot-left").attr("data-angle",angle)},calculateAngle:function(btn,operate,defaultValue){var leftDom=$(btn).parent().find(".rot-left");var angle=leftDom.attr("data-angle");try{if(operate=="left"){defaultValue=parseInt(angle)-90}else{defaultValue=parseInt(angle)+90}}catch(e){}return defaultValue},hideModal:function(btn){var $this=this;var $img=$(btn).parent().find("img");$(btn).parents(".img-modal").modal("hide");$(btn).parent().find(".rot-left").attr("data-angle",0);setTimeout(function(){$img.rotate({angle:0});$this.setMaxWidth($img,0)},300)},setMaxWidth:function(imgDom,angle){if((Math.abs(angle/90))%2!=0){$(imgDom).css("max-width","600px")}else{$(imgDom).css("max-width","1138px")}},doDase64:function(file,backData){var $this=this;var reader=new FileReader();var image=new Image();var canvas=$this.createCanvas();var ctx=canvas.getContext("2d");reader.onload=function(){var result=this.result;image.onload=function(){var imgScale=$this.imgScaleW(1000,this.width,this.height);canvas.width=imgScale.width;canvas.height=imgScale.height;ctx.drawImage(image,0,0,imgScale.width,imgScale.height);var dataURL=canvas.toDataURL("image/jpeg");ctx.clearRect(0,0,imgScale.width,imgScale.height);backData(dataURL)};image.src=result};reader.readAsDataURL(file)},createCanvas:function(){var canvas=document.getElementById("canvas");if(!canvas){var canvasTag=document.createElement("canvas");canvasTag.setAttribute("id","canvas");canvasTag.setAttribute("style","display:none;");document.body.appendChild(canvasTag);canvas=document.getElementById("canvas")}return canvas},imgScaleW:function(maxWidth,width,height){var imgScale={};var w=0;var h=0;if(width<=maxWidth&&height<=maxWidth){imgScale={width:width,height:height}}else{if(width>=height){w=maxWidth;h=Math.ceil(maxWidth*height/width)}else{h=maxWidth;w=Math.ceil(maxWidth*width/height)}imgScale={width:w,height:h}}return imgScale}}}(jQuery));var uploadbox=(function($){var _rootFolder;var _path;return{upload:function(oFileInput,pathInputId,rootFolder,path,storageHost,frontOrAdmin,onuploaded){if(_rootFolder){rootFolder=_rootFolder}if(_path){path=_path}$.get(base+"/"+frontOrAdmin+"/storage/getToken?rootFolder="+rootFolder,function(datas){if(datas.success){var token=datas.returnObject;var formData=new FormData();formData.append("key",path);formData.append("token",token);console.log("upload starting0");formData.append("file",oFileInput.files[0]);console.log("upload starting");jQuery.ajax({url:storageHost+"/upload/",type:"POST",processData:false,contentType:false,data:formData,success:function(datas){$("#"+pathInputId).val(rootFolder+"/"+path);if(onuploaded){var onuploadedFunc=eval(onuploaded);if(onuploadedFunc){return onuploadedFunc(pathInputId)}}},error:function(xhr){var returnObject=JSON.parse(xhr.responseText);ModalBox.alert("<br/>上传文件失败，资源中心提示：<br/>"+returnObject.message)}})}})}}}(jQuery));var uploadattachment=(function(c){var b;var a;return{upload:function(i,j,d,g,f,h,e){if(b){d=b}if(a){g=a}c.get(base+"/"+h+"/storage/getToken?rootFolder="+d,function(k){if(k.success){var m=k.returnObject;var n=new FormData();var l=c(i).val();var o=l.substring(l.lastIndexOf("\\")+1,l.length);g=g+"/"+o;n.append("key",g);n.append("token",m);console.log("upload starting0");n.append("file",i.files[0]);console.log("upload starting");jQuery.ajax({url:f+"/upload/",type:"POST",processData:false,contentType:false,data:n,success:function(p){var s=d+"/"+g;var t=o.replace(".","_");var u=f+"/bucket/"+s;var q="<input type='hidden' name='"+j+"' value='"+s+"'/>";var r="<span style='margin-left:15px;' id='"+t+"'>"+q+"<a href='"+u+"' style='text-decoration:underline;'>"+o+"</a>&nbsp;<a href='javascript:void(0);' onclick='uploadattachment.delCurrent(this)'>删除</a></span>";if(typeof(c("#"+t).attr("id"))=="undefined"){c("#attachment_name").append(r)}c("input[type=file]").val("")},error:function(q){var p=JSON.parse(q.responseText);ModalBox.alert("<br/>上传文件失败，资源中心提示：<br/>"+p.message)}})}})},delCurrent:function(e){var d=c(e).parent();d.remove()}}}(jQuery));var cloView=(function(a){return{init:function(d){var c=a(d);c.parent().find(".clo_ul").toggle();c.toggleClass("clo_sub");var e=c.attr("id");var b=c.parent().parent().find(".clo_ctr").filter(function(){var f=a(this).attr("id");if(f==e){return false}return true});b.each(function(){a(this).removeClass("clo_sub").addClass("clo_add");a(this).parent().find(".clo_ul").hide()})},initclick:function(c){var b=a(c);a(".clo_cts_ul").toggle();b.toggleClass("clo_sub")},buryingPoint:function(b){if(typeof(sugoio)!="undefined"){sugoio.track(b.text,{page_name:"新增销售单提交成功",event_type:"click",event_name:b.text})}}}}(jQuery));var productautocompletebox=(function(e){var c=false;var d=false;var g=0;function b(j){var m,i,l,k,h;m=j.data("frontoradmin");i=j.data("url");l=j.data("producttype");k=j.data("pricegrouptype");h=j.data("listtypecode");if((l=="P"||l=="M")&&h=="*"){h=l}if(m==null||i==null||k==null||h==null){return null}else{return base+"/"+m+i+"/"+k+"/"+h}}function f(h,i){return h.indexOf(i)==-1}function a(h,i){h=h.replace(","+i,"");h=h.replace(i+",","");h=h.replace(i,"");return h}return{init:function(){var j,h,o,n,q,l,i,p,k,m;j=e(".productautocompletebox");j.each(function(){h=e(this).find(".pacb-productCodes");o=e(this).find(".pacb-productNames");n=e(this).find(".search-field");i=e.trim(h.val());p=e.trim(o.val());if(i&&p){k=i.split(",");m=p.split(",");for(var r=0;r<k.length;r++){q=productautocompletebox.buildChoice(k[r],m[r]);n.before(q)}}});e(document).click(function(s){var r=e(s.target);var v=r.closest(".productautocompletebox");if(!v[0]){var u=e(".pacb-chosen-drop");u.hide();c=false;d=false}else{var t=v.find(".search-field").find("input");t.focus()}})},buildChoice:function(k,j){var i,h;i=e("<li/>",{"class":"search-choice"}).html("<span>"+j+"</span>");h=e("<a>",{"class":"search-choice-close","data-productcode":k,"data-productname":j});h.bind("click",function(){productautocompletebox.delOption(this)});i.append(h);return i},addOption:function(k){var j,h,n,m,q,o,l,i,p;j=k.closest(".productautocompletebox");h=j.find(".pacb-productCodes");n=j.find(".pacb-productNames");o=k.data("productcode");l=k.text();i=e.trim(h.val());p=e.trim(n.val());if(f(i,o)){if(i.length>0){i=i+","+o;p=p+","+l}else{i=o;p=l}h.val(i);n.val(p);m=j.find(".search-field");q=productautocompletebox.buildChoice(o,l);m.before(q)}},recoverOption:function(k){var i,h,n,j,l,p,o,m;i=k.closest(".productautocompletebox");h=i.find(".pacb-productCodes");n=i.find(".pacb-productNames");o=k.data("productcode");m=k.text();h.val(o);n.val(m);j=i.find(".search-choice");j.remove();l=i.find(".chosen-choices");p=productautocompletebox.buildChoice(o,m);l.prepend(p)},delOption:function(q){var h,k,i,o,n,j,p,m,l;h=e(q);k=h.closest(".productautocompletebox");i=k.find(".pacb-productCodes");o=k.find(".pacb-productNames");j=e.trim(i.val());p=e.trim(o.val());m=h.data("productcode");l=h.data("productname");j=a(j,m);p=a(p,l);i.val(j);o.val(p);h.parents("li").first().remove();n=k.find(".search-field").find("input");n.focus()},hideOption:function(i){var h=i.find(".chosen-drop");h.hide();c=false;d=false},chooseOption:function(i){var k=e(i);var j=k.closest(".productautocompletebox");var l=j.data("mutltipleselect");if(l){productautocompletebox.addOption(k)}else{productautocompletebox.recoverOption(k)}productautocompletebox.hideOption(j);var h=j.find(".search-field").find("input");h.val("").focus();g=0},showOption:function(l){var o,k,i,p,n,p,m,q,j;o=e(l);k=o.closest(".productautocompletebox");p=k.find(".chosen-drop");j=e.trim(o.val());if(j){var h=b(k);if(h){e.ajax({url:h,type:"post",dataType:"json",data:{productKey:j},success:function(s){var t=s;i=k.find(".chosen-results");i.html("");for(var r=0;r<t.length;r++){n=e("<li>",{"class":"active-result","data-productcode":t[r].productCode}).text(t[r].productShortName);n.bind("click",function(){productautocompletebox.chooseOption(this)}).bind("mouseover",function(){productautocompletebox.optionMouseover(this)}).bind("mouseout",function(){productautocompletebox.optionMouseout(this)}).bind();i.append(n)}p.show();c=true;d=false}})}}},optionMouseover:function(i){var h=e(i);h.addClass("highlighted");d=true},optionMouseout:function(i){var h=e(i);h.removeClass("highlighted");d=false},optionDown:function(n){var o,l,p,h,j,q,i;o=e(n);l=o.closest(".productautocompletebox");p=l.find(".chosen-drop");h=l.find(".chosen-results");if(c&&!d){p.find("li").first().addClass("highlighted")}else{var m=p.find("li.highlighted");var k=m.nextAll("li.active-result").first();if(k.length>0){p.find("li").removeClass("highlighted");k.addClass("highlighted");j=k[0].offsetTop;q=k[0].clientHeight;i=h[0].offsetHeight;if(j-i>=0){h.scrollTop(q+h.scrollTop())}}}d=true},optionUp:function(n){var o,k,p,h,j,m;o=e(n);k=o.closest(".productautocompletebox");p=k.find(".chosen-drop");h=k.find(".chosen-results");if(c&&!d){p.find("li").first().addClass("highlighted")}else{var l=p.find("li.highlighted");var i=l.prevAll("li.active-result").first();if(i.length>0){p.find("li").removeClass("highlighted");i.addClass("highlighted");j=i[0].offsetTop;m=i[0].clientHeight;if(j<=0){h.scrollTop(h.scrollTop()-m)}}}d=true},inputKeyup:function(l,q){var n,j,o,m,s,h,p;n=e(l);p=e.trim(n.val());j=n.closest(".productautocompletebox");s=(h=q.which)!=null?h:q.keyCode;switch(s){case 8:q.preventDefault();if(g<1){var i=n.parent().prevAll("li.search-choice").first();if(i){var r=i.find("a")[0];productautocompletebox.delOption(r)}}g=p.length;productautocompletebox.showOption(l);break;case 13:q.preventDefault();o=j.find(".chosen-drop");var k=o.find("li.highlighted");if(k){productautocompletebox.chooseOption(k[0])}break;case 38:q.preventDefault();productautocompletebox.optionUp(l);break;case 40:q.preventDefault();productautocompletebox.optionDown(l);break;default:g=p.length;productautocompletebox.showOption(l);break}}}}(jQuery));var qabox=(function(a){return{init:function(){a(".qa-item .qa-item-title").click(function(){var b=a(this).parent();if(b.find(".qa-img-down").is(":visible")){b.find(".qa-img-down").hide();b.find(".qa-img-up").show();b.find(".qa-hr").show();b.find(".qa-desc").slideDown(500)}else{b.find(".qa-img-up").hide();b.find(".qa-img-down").show();b.find(".qa-desc").slideUp(500,function(){b.find(".qa-hr").hide()})}});a(".qa-item .qa-desc .qa-a-link").each(function(){a(this).click(function(){var b=a("#"+a(this).attr("question"));if(b.length>0){a("html,body").animate({scrollTop:b.offset().top},800);if(b.find(".qa-img-down").is(":visible")){b.find(".qa-item-title").click()}}})})}}}(jQuery));var dealerGroupBox=(function(c){function d(){var e=base+"/admin/dealerGroup/showDealerGroupDialog";c.ajax({url:e,type:"POST",dataType:"json",success:function(g){console.log("data:"+g.dealerGroupResultList);var f="";c("#dealerGroupAllTypesByUi").html("");var h=g.dealerGroupResultList;c.each(h,function(k,j){if(j.manualMember){f+='<a href="javascript:void(0);" class="left-menu-item2" role="menuitems" value="'+j.id+'" name="'+j.groupName+'" onclick="dealerGroupBox.doSearchDealerGroup(\''+j.id+"')\" >"+j.groupName+'<div style="float:right;display:inline-block;"></div></a>'}});f+='<div class="line"></div>';c.each(h,function(k,j){if(!j.manualMember){f+='<a href="javascript:void(0);" class="left-menu-item2" role="menuitems" value="'+j.id+'" name="'+j.groupName+'" onclick="dealerGroupBox.doSearchDealerGroup(\''+j.id+"')\" >"+j.groupName+'<div style="float:right;display:inline-block;"></div></a>'}});c("#dealerGroupAllTypesByUi").html(f);b()},error:function(g){var f=JSON.parse(g.responseText);ModalBox.alert("获取数据失败"+f.message)}})}function b(){c('a[role="menuitems"]').click(function(){var e=c(this);if(!e.hasClass("left-menu-active")){c('a[role="menuitems"]').removeClass("left-menu-active");e.addClass("left-menu-active");c("input[name='dealerGroupCriteria.id']").val(e.attr("value"))}})}function a(g,k,j,h,e,m){if(h){var f=h(e);if(!f){if(e){showTips("请检查查询条件是否满足要求。",e)}return}}if(!k){k="formQueryCriteria"}if(!j){j="divQueryResult"}var l=true;if(l){pageRows=pagination.pageRows;if(typeof(pageRows)!="undefined"&&g.indexOf("rows")<0){var i=g.indexOf("?");if(i<0){g+="?rows="+pageRows}else{if(i==g.length-1){g+="rows="+pageRows}else{g+="&rows="+pageRows}}}c.post(g,c("#"+k).serialize(),function(n){if(n.exceptionMessage){ModalBox.alert({message:n.exceptionMessage,title:"提示"})}else{c("#"+j).html(n);if(c(".showRowId").length>0){c(".showRowId").trigger("chosen:updated.chosen");c(".showRowId").chosen();c(".showRowId_chosen .chosen-search").remove()}if(m){m()}}})}}return{init:function(){Array.prototype.remove=function(f){var e=this.indexOf(f);if(e>-1){this.splice(e,1)}}},checkAll:function(f){var j=c(".headHiddenData").val();var h=c("#headDealerGroupName").val();var i=c(f).prop("checked");c("input[name='group']:not(:disabled)").each(function(){this.checked=i});var e=j.split(",");var g=h.split(",");e.remove("");g.remove("");if(i){c("#headDiv").attr("style","display:");c("input[name='group']:not(:disabled)").each(function(){e.remove(c(this).val());g.remove(c(this).data("name"));e.push(c(this).val());g.push(c(this).data("name"))});c(".headHiddenData").val(e.join(","));c("#headDealerGroupName").text(g.join(","))}else{c("input[name='group']:not(:disabled)").each(function(){e.remove(c(this).val());g.remove(c(this).data("name"))});if(e.length==0){c(".headHiddenData").val("");c("#headDealerGroupName").text("");c("#headDiv").attr("style","display:none")}else{c(".headHiddenData").val(e.join(","));c("#headDealerGroupName").text(g.join(","))}}},selectValue:function(k){var f=c(".hiddenData").data("ismultiselect");var j=c(".headHiddenData").val();var m=c("#headDealerGroupName").val();var h=c(k).val();var g=c(k).data("name");var i=c(k).prop("checked");if(f=="0"){c("#headDiv").attr("style","display:none");c(".headHiddenData").val("");c("#headDealerGroupName").text("");c(".headHiddenData").val(h);c("#headDealerGroupName").text(g);dealerGroupBox.onHide()}else{if(i){c("#headDiv").attr("style","display:");if(j.indexOf(h)==-1){if(j==""){c(".headHiddenData").val(h);c("#headDealerGroupName").append(g)}else{j+=","+h;c(".headHiddenData").val(j);c("#headDealerGroupName").append(",");c("#headDealerGroupName").append(g)}}}else{c("#selectAll").prop("checked",false);if(j.indexOf(h)!=-1){var e=j.split(",");if(e.length>1){e.remove(h);h=e.join(",");c(".headHiddenData").val(h);var l=m.split(",");l.remove(g);g=l.join(",");c("#headDealerGroupName").text(g)}else{c(".headHiddenData").val("");c("#headDealerGroupName").text("");c("#headDiv").attr("style","display:none")}}}}},onEmpty:function(){c(".hiddenData").val("");c("#dealerGroupName").text("");c(".headHiddenData").val("");c("#headDealerGroupName").text("");c("#headDiv").attr("style","display:none")},onHide:function(){var f=c(".headHiddenData").val();var e=c("#headDealerGroupName").text();c(".hiddenData").val(f);c("#dealerGroupName").text(e);c(".headHiddenData").val("");c("#headDealerGroupName").text("");c("#headDiv").attr("style","display:none");c("#dealerGroupNumberDivPage").modal("hide")},doSearchAllDealerGroup:function(){c("input[name='dealerGroupCriteria.id']").val("");c("input[name='dealerGroupCriteria.parentGroupId']").val("");c("input[name='dealerGroupCriteria.groupName']").val("");if(!Validation.validateForm(c("#formQueryCriteria")[0],this)){return false}var f=c(".hiddenData").data("ismultiselect");var e=base+"/admin/dealerGroup/listDealerGroupDialog?isMultiSelect="+f;a(e,"formQueryCriteria","queryResultDivByUi")},doSearchDealerGroup:function(e){c("input[name='dealerGroupCriteria.parentGroupId']").val(e);if(!Validation.validateForm(c("#formQueryCriteria")[0],this)){return false}var g=c(".hiddenData").data("ismultiselect");var f=base+"/admin/dealerGroup/listDealerGroupDialog?isMultiSelect="+g+"&parentGroupId="+e;a(f,"formQueryCriteria","queryResultDivByUi")},doFindSearch:function(){var e=c("input[name='dealerGroupCriteria.parentGroupId']").val();var h=c("#findGroupName").val();if(h!=undefined&&h!=null&&h!=""){c("input[name='dealerGroupCriteria.groupName']").val(h)}else{c("input[name='dealerGroupCriteria.groupName']").val("")}if(e!=undefined&&e!=null&&e!=""){c("input[name='dealerGroupCriteria.parentGroupId']").val(e)}else{c("input[name='dealerGroupCriteria.parentGroupId']").val("")}var g=c(".hiddenData").data("ismultiselect");h=encodeURI(encodeURI(h));var f=base+"/admin/dealerGroup/listDealerGroupDialog?isMultiSelect="+g+"&parentGroupId="+e+"&groupName="+h;a(f,"formQueryCriteria","queryResultDivByUi")},showDialog:function(){d();dealerGroupBox.onEmpty();dealerGroupBox.doSearchAllDealerGroup();c("#dealerGroupNumberDivPage").modal({keyboard:false,show:true,backdrop:"static"})},doSave:function(f){if(f!=null&&typeof f=="function"){var e=c(".headHiddenData").val();if(e!=""){f(e);dealerGroupBox.onHide()}else{ModalBox.alert("请选择一条数据！")}}else{dealerGroupBox.onHide()}}}}(jQuery));$(function(){selectbox.init();addressbox.init();searchbox.init();fixedtool.init();dealerbox.init();idcardbox.init();mobilebox.init();banknobox.init();timer.init();datebox.init();datetimebox.init();autocompletebox.init();imgUploadBox.init();productautocompletebox.init();qabox.init();dealerGroupBox.init()});